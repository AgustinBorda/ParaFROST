\documentclass[conference]{IEEEtran}
\IEEEoverridecommandlockouts
\usepackage{cite}
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{algorithmic}
\usepackage{graphicx}
\usepackage{textcomp}
\usepackage{xcolor}
\usepackage{xspace}
\usepackage{url}

%
\newcommand{\quotes}[1]{``#1''}
\newcommand{\nMoves}{\ensuremath{m}\xspace}
\newcommand{\bSize}{\ensuremath{n}\xspace}
\newcommand{\clr}{\ensuremath{c}\xspace}
\newcommand{\nColors}{\ensuremath{k}\xspace}
\newcommand{\flood}[2]{\ensuremath{\mathcal{F}(#1,#2)}\xspace}
\newcommand{\move}[2]{\ensuremath{\mathcal{M}(#1,#2)}\xspace}
\newcommand{\touch}[2]{\ensuremath{\mathcal{T}(#1,#2)}\xspace}
\newcommand{\turn}{\ensuremath{t}\xspace}
\newcommand{\field}{\ensuremath{f}\xspace}
\newcommand{\cluster}{\ensuremath{\mathcal{C}}\xspace}


% mute the stupid IEEEtrans bibtex error!
\makeatletter
\def\endthebibliography{%
	\def\@noitemerr{\@latex@warning{Empty `thebibliography' environment}}%
	\endlist
}
\makeatother

\begin{document}

\title{SAT Encodings for Flood-It Puzzle
}

\author{
	\IEEEauthorblockN{Milan van Stiphout}
	\IEEEauthorblockA{Faculty of Science\\
		Radboud University, Nijmegen, The Netherlands\\
		milanstiphout@gmail.com
	}
	\and
	\IEEEauthorblockN{Muhammad Osama and Anton Wijs}
	\IEEEauthorblockA{Department of Mathematics and Computer Science\\
		Eindhoven University of Technology, Eindhoven, The Netherlands\\
		\{o.m.m.muhammad, a.j.wijs\}@tue.nl
	}
}

\maketitle

\begin{abstract}
Flood-it is a puzzle in which, the player aims to fill the game board (flood) with a minimum number of flooding moves. Finding an optimal solution to this game is an NP-Complete problem. In this paper, we describe a possible encoding of the game to propositional Satisfiability problem. 
\end{abstract}

\section{Introduction}
Flood-It is a board game in which the player is given an $\bSize\times\bSize$ board of squares (we call them fields), where each one is allocated one of \clr colors. The goal is to fill the entire board with the same color via the shortest possible sequence of flooding moves from the top left. If $\clr \ge 3$, Flood-It complexity becomes NP-Hard\cite{floodit, floodit2}.

Each move dictates the player to choose a color. In turn, all flooded fields change their color to the chosen color. This procedure is recursive as any field touching the flooded region with the same color is also flooded. As the flooded region grows, new neighbors will be eligible for flooding in the next move. The process continues until the whole board is filled with a single color with lowest possible moves.

\section{SAT Encoding}
The intuition of solving the game in SAT, is to let a SAT solver find the shortest sequence of moves that completes the puzzle. In this section, we briefly describe a strategy which is proposed by the first author in his bachelor thesis\cite{thesis} to formulate the game rules with a set of predicates in Conjunctive Normal Form (CNF).

Nevertheless, solving a single encoding gives only part of the answer to the question \quotes{how many minimal moves is needed to solve Flood-It puzzle?}. The minimal solution is rather logarithmically approached by choosing a value \nMoves that allows the corresponding SAT formula satisfiable.
\subsection{Game Properties}
The properties of the game are expressed in the following predicates: 
\begin{itemize}
	\item \flood{\turn}{\field} is true if a field \field is flooded at turn \turn. 
	\item \move{\turn}{\clr} is true if a color \clr is chosen at turn \turn. 
	\item \touch{\turn}{\field} is true if \field is next to a flooded field at \turn. 
\end{itemize}

These predicates define the Boolean variables of the SAT formula that encodes Flood-It puzzle. The assignments of the \emph{move} predicates $\mathcal{D}$, along with the proposed conditions, give a possible sequence of moves that we need to solve the game. 
\subsection{Flood Conditions}
The following conditions are designed in such a way to strictly follow the rules of Flood-It. This grantees a tangible solution of the puzzle via a satisfying assignment to the corresponding SAT problem.
\begin{enumerate}
	\item A cluster \cluster of orthogonal fields is flooded at \turn = 0 starting from the top-left-corner field \field = 0 (precondition).
	\begin{equation}
	\bigwedge_{\field=0}^{{\bSize^2}-1}
	\begin{cases}
	\flood{0}{\field}&, \text{if\:} \field\in\cluster\\
	\neg\flood{0}{\field}&, \text{otherwise}\\
	\end{cases}
	\end{equation}
	\item One move can be made at a turn with exactly one color. The notations \nMoves and \nColors denote the maximum number of moves allowed and the number of colors available respectively.
	\begin{equation}
	\bigwedge_{\turn=0}^{\nMoves-1}
	\bigvee_{\clr=0}^{\nColors-1}
	\move{\turn}{\clr}
	\end{equation}
	\begin{equation}
	\bigwedge_{\turn=0}^{\nMoves-1}
	\bigwedge_{\clr=0}^{\nColors-2}
	\bigwedge_{d=\clr+1}^{\nColors-1}
	\neg\move{\turn}{\clr}\vee
	\neg\move{\turn}{d}
	\end{equation}
	\item A flooded field will remain flooded to the end of the game
	\begin{equation}
	\bigwedge_{\turn=0}^{\nMoves-1}
	\bigwedge_{\field=0}^{{\bSize^2}-1}
	\flood{\turn}{\field}\Rightarrow\flood{\turn+1}{\field}
	\end{equation}
	\item If a field \field is not already flooded and not touched by any other field $g_i$ such that $1\leq i \leq k$, then \field will not be flooded. 
	\begin{multline}
	\bigwedge_{\turn=0}^{\nMoves}
	\bigwedge_{\field=0}^{{\bSize^2}-1}
	\neg\flood{\turn}{\field}\wedge\neg\touch{\turn}{g_1}\wedge\dots\wedge\neg\touch{\turn}{g_k}\\
	\Rightarrow\neg\flood{\turn+1}{\field}
	\end{multline}
	\item If a move is made with an \field's color ($\clr_\field$), and that field touches the flooded region, it is flooded.
	\begin{equation}
	\bigwedge_{\turn=0}^{\nMoves-1}
	\bigwedge_{\field=0}^{{\bSize^2}-1}
	\move{\turn}{\clr_\field}\wedge\touch{\turn}{\field}\Rightarrow\flood{\turn+1}{\field}
	\end{equation}
	\item If a move is made of not  $\clr_\field$ and \field is not flooded already, then \field is not flooded.
	\begin{equation}
	\bigwedge_{\turn=0}^{\nMoves-1}
	\bigwedge_{\field=0}^{{\bSize^2}-1}
	\neg\move{\turn}{\clr_\field}\wedge\neg\flood{\turn}{\field}\Rightarrow\neg\flood{\turn+1}{\field}
	\end{equation}
	\item Whenever a field is flooded, all neighbors ($g_1\dots g_k$) with the same color are flooded as well.
	\begin{equation}
	\bigwedge_{\turn=0}^{\nMoves}
	\bigwedge_{\field=0}^{{\bSize^2}-1}
	\flood{\turn}{\field}\Leftrightarrow\flood{\turn}{g_1}\vee\dots\vee\flood{\turn}{g_k}
	\end{equation} 
	\item A field is flooded iff it touches a direct orthogonal neighbor ($\bSize_1\dots \bSize_k$).
	\begin{equation}
	\bigwedge_{\turn=0}^{\nMoves}
	\bigwedge_{\field=0}^{{\bSize^2}-1}
	\touch{\turn}{\field}\Leftrightarrow\flood{\turn}{n_1}\vee\dots\vee\flood{\turn}{n_k}
	\end{equation} 
	\item All fields are flooded after a maximum number of moves \nMoves at $\turn=\nMoves+1$ (postcondition).
	\begin{equation}
	\bigwedge_{\field=0}^{{\bSize^2}-1}
	\flood{\nMoves+1}{\field}
	\end{equation} 
\end{enumerate}
\section{Benchmarks}
In benchmarks generation, we chose $\nColors=10$ and a set of different dimensions $n=\{40,41,42,43,44,45\}$. The maximum number of moves \nMoves is determined by running a greedy solver prior to SAT encoding. For these settings, 20 instances are generated randomly. All benchmarks are satisfiable and easy to solve (within 1-2 minutes).
%========== references ===========
\bibliographystyle{IEEEtran}
\bibliography{IEEEabrv,bench_refs}

\end{document}
